(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{18:function(e,t,n){"use strict";var r=n(13);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(r.get)(e,t,n)}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.hasOwnProperty(t)&&(e[t]=!e[t]),e}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var a=m(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(i,e);var t,n,a,o=v(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.errors,r=void 0===n?{}:n;return d(this,i),(e=o.call(this)).errors={},e.record(r),e}return t=i,a=[{key:"make",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.errors,n=void 0===t?{}:t;return new i({errors:n})}}],(n=[{key:"record",value:function(e){return this.clear(),this.errors=u({},e),this}},{key:"add",value:function(e){return this.errors=u(u({},this.errors),e),this}},{key:"recordResponse",value:function(e){if(e&&e.data){var t=e.data.errors,n=void 0===t?{}:t;this.record(n)}return this}},{key:"all",value:function(){return this.errors}},{key:"message",value:function(e){var t,n=this.has(e)?this.errors[e]:this.get("errors.".concat(e),null);return n&&Object(r.isArray)(n)&&n.length&&(t=n[0]),t}},{key:"has",value:function(e){return this.errors.hasOwnProperty(e)}},{key:"state",value:function(e){return!this.has(e)&&null}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?this.errors[e]&&(Object(r.isArray)(e)||(e=[e]),this.errors=Object(r.omit)(this.errors,e)):this.errors={},this}}])&&p(t.prototype,n),a&&p(t,a),i}(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o(this,e,t)}},{key:"set",value:function(e,t){this[e]=t}},{key:"toggle",value:function(e){i(this,e)}},{key:"has",value:function(e){return null!==this.get(e)}},{key:"remember",value:function(e,t){return this.has(e)||this.set(e,t),this.get(e)}}])&&a(t.prototype,n),r&&a(t,r),e}());t.a=w},28:function(e,t,n){"use strict";var r=n(2),a=n.n(r),o=(n(199),n(21)),i=n(6),s=n(42);function c(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function u(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){u(o,r,a,i,s,"next",e)}function s(e){u(o,r,a,i,s,"throw",e)}i(void 0)}))}}var d={props:{userId:{type:Number,required:!0}},components:{vueDropzone:n.n(s).a},data:function(){var e=this;return{status:!0,isProcessing:!1,dropzoneOptions:{url:"/api/files/upload/".concat(this.userId,"/evidences"),headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.head.querySelector('meta[name="csrf-token"]').content},thumbnailMethod:"contain",thumbnailWidth:500,thumbnailHeight:500,previewTemplate:this.template(),renameFile:function(t){var n=1,r=e.$refs.dropzoneIdCard.$refs.dropzoneElement.querySelectorAll(".dz-preview");r&&(n=r.length+1);e.user;return"".concat(e.user.evidenceFileNamePrefix,"-").concat(n,".").concat(t.name.split(".").pop())},capture:!0,acceptedFiles:"image/*"},toastUploadEvidenceSuccess:!1,toastUploadEvidenceFail:!1,toastDeleteEvidenceSuccess:!1,toastDeleteEvidenceFail:!1}},watch:{userId:{immediate:!0,handler:function(e){this.fetch(e)}}},computed:{user:function(){return i.a.query().find(this.userId)}},methods:{template:function(){return'<div class="dz-preview dz-file-preview">\n                <div class="dz-image">\n                    <img data-dz-thumbnail />\n                </div>\n                <div class="dz-details">\n                    <div class="dz-filename"><span data-dz-name></span></div>\n                </div>\n                <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n                <div class="dz-error-message"><span data-dz-errormessage></span></div>\n                <a class="dz-custom-remove" href="javascript:undefined;" data-dz-custom-remove>ลบไฟล์</a>\n                <a class="dz-show" href="javascript:undefined;" data-dz-show>ดูภาพเต็มจอ</a>\n                <a class="dz-download" href="javascript:undefined;" data-dz-download>ดาว์นโหลด</a>\n            </div>\n        '},onDropzoneThumbnail:function(e,t){if(e&&e.previewElement&&t){var n=e.previewElement.querySelector("span[data-dz-name]");n&&e.upload&&(n.innerText=e.upload.filename)}},onDropzoneError:function(e,t){if(this.toastUploadEvidenceFail=!0,e&&e.previewElement&&t&&t.message){var n=e.previewElement.querySelector("span[data-dz-errormessage]");n&&(n.innerText=t.message)}},onDropzoneSuccess:function(e,t){if(this.toastUploadEvidenceSuccess=!0,e&&e.previewElement&&t&&t.files&&t.files.length){var n=t.files[0];n&&(this.$set(e,"id",n.id),this.$set(e,"mime",n.mime),this.$set(e,"original_name",n.original_name),this.$set(e,"path",n.path)),this.bindEvent(e)}},bindEvent:function(e){var t=this,n=e.previewElement.querySelector("a[data-dz-custom-remove]");n&&n.addEventListener("click",l(a.a.mark((function n(){var r;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,o.a.api().destroy(e.id);case 3:r=n.sent,t.toastDeleteEvidenceSuccess=!0,t.$refs.dropzoneIdCard.removeFile(e),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(0),console.error(n.t0),t.toastDeleteEvidenceFail=!0;case 12:return n.abrupt("return",r);case 13:case"end":return n.stop()}}),n,null,[[0,8]])}))));var r=e.previewElement.querySelector("a[data-dz-show]");r&&r.addEventListener("click",(function(){window.open("".concat(window.location.origin,"/").concat(e.path))}));var i=e.previewElement.querySelector("a[data-dz-download]");i&&i.addEventListener("click",(function(){var t=document.createElement("a");t.setAttribute("download",e.original_name),t.setAttribute("href","".concat(window.location.origin,"/").concat(e.path)),t.click()}))},fetch:function(e){var t=this;return l(a.a.mark((function n(){var r,s,u;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,i.a.api().get("/".concat(e),{params:{includes:["files"]}});case 3:n.sent,(r=i.a.query().with(["files"]).find(e))&&(s=r.file_ids,(u=void 0===s?[]:s).length&&o.a.findIn(u).forEach(function(){var e=l(a.a.mark((function e(n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new File([c(n.size)],n.original_name,{type:n.mime}),t.$set(r,"id",n.id),t.$set(r,"path",n.path),t.$refs.dropzoneIdCard.manuallyAddFile(r,"".concat(window.location.origin,"/").concat(n.path));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),console.error(n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()},download:function(e){return l(a.a.mark((function t(){var n,r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.a.api().download(e.id);case 2:return n=t.sent,r=n.response.data,t.abrupt("return",new Blob([r],{type:e.mime}));case 5:case"end":return t.stop()}}),t)})))()},onDropzoneFileAdded:function(e){e.manuallyAdded&&this.bindEvent(e)},onDropzoneProcessing:function(){this.isProcessing=!0},onDropzoneComplete:function(){this.isProcessing=!1}}},p=n(3),f=Object(p.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("fieldset",{staticClass:"mt-2",attrs:{id:"fieldset-checkbox-pawn-card",disabled:e.status}},[n("b",[e._v("อัพโหลดหลักฐาน")]),e._v(" "),n("vue-dropzone",{ref:"dropzoneIdCard",attrs:{id:"dropzone",options:e.dropzoneOptions},on:{"vdropzone-processing":e.onDropzoneProcessing,"vdropzone-complete":e.onDropzoneComplete,"vdropzone-thumbnail":e.onDropzoneThumbnail,"vdropzone-error":e.onDropzoneError,"vdropzone-success":e.onDropzoneSuccess,"vdropzone-file-added":e.onDropzoneFileAdded}})],1)]),e._v(" "),n("b-toast",{attrs:{id:"evidence-upload-toast-success",variant:"success",solid:"","no-close-button":""},model:{value:e.toastUploadEvidenceSuccess,callback:function(t){e.toastUploadEvidenceSuccess=t},expression:"toastUploadEvidenceSuccess"}},[e._v("\n    อัพโหลดหลักฐานการจำนำสำเร็จเรียบร้อย\n  ")]),e._v(" "),n("b-toast",{attrs:{id:"evidence-upload-toast-fail",variant:"danger",solid:"","no-close-button":""},model:{value:e.toastUploadEvidenceFail,callback:function(t){e.toastUploadEvidenceFail=t},expression:"toastUploadEvidenceFail"}},[e._v("\n    อัพโหลดหลักฐานการจำนำไม่สำเร็จ\n  ")]),e._v(" "),n("b-toast",{attrs:{id:"evidence-delete-toast-success",variant:"success",solid:"","no-close-button":""},model:{value:e.toastDeleteEvidenceSuccess,callback:function(t){e.toastDeleteEvidenceSuccess=t},expression:"toastDeleteEvidenceSuccess"}},[e._v("\n    ลบหลักฐานการจำนำสำเร็จเรียบร้อย\n  ")]),e._v(" "),n("b-toast",{attrs:{id:"evidence-delete-toast-fail",variant:"danger",solid:"","no-close-button":""},model:{value:e.toastDeleteEvidenceFail,callback:function(t){e.toastDeleteEvidenceFail=t},expression:"toastDeleteEvidenceFail"}},[e._v("\n    ลบหลักฐานการจำนำไม่สำเร็จ\n  ")])],1)}),[],!1,null,null,null);t.a=f.exports},5:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return c})),n.d(t,"e",(function(){return y})),n.d(t,"d",(function(){return g}));var r={props:{disabled:{type:Boolean,default:function(){return!1}}}},a=n(1),o=n.n(a),i=(n(194),{computed:{today:function(){return function(e){return o()()[e]()}},cityTimezone:function(){var e=o.a.tz.guess();return e.substr(e.indexOf("/")+1)},formatingDatetime:function(){return function(e,t){return o.a.locale("th"),e?o()(e).add(543,"year").format(t):"ไม่ระบุ"}}},methods:{diffMonth:function(e,t){return Math.ceil(o()(t).diff(o()(e),"months",!0))}}}),s=n(18),c={props:{error:{type:s.a,default:function(){return s.a.make()}}}},u=n(2),l=n.n(u),d=n(8),p=n(11),f=n(6),v=n(9),h=n(13);function m(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function w(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){m(o,r,a,i,s,"next",e)}function s(e){m(o,r,a,i,s,"throw",e)}i(void 0)}))}}var y={data:function(){return{perPage:20,currentPage:1,totalRows:0,searchInput:"",search:!1,loading:!1,items:{}}},computed:{pawns:function(){return d.a.query().get()},user:function(){return Object(h.groupBy)(f.a.query().get(),(function(e){return e.id}))},pawnUserItems:function(){return v.a.query().with(["pawn_items"]).all()},closabledPawnUserItems:function(){return v.a.query().with(["pawn_items"]).where("complete",!1).get()},pawnItemsByPawnID:function(){return Object(h.groupBy)(p.a.query().get(),(function(e){return e.pawn_id}))},fullName:function(){return this.user?this.user.full_name:"-"}},methods:{fetchPawns:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return d.a.api().get("/pawns",{params:{search:{keyword:e,fields:t},includes:["user","pawn_items","pawns.pawn_items.item_damage","pawns.pawn_items.item_category"]}})},fetchUserPawn:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return f.a.api().get("users",{params:{search:{keyword:e,fields:t},includes:["pawns","pawns.pawn_items","pawns.pawn_items.item_category","pawns.pawn_items.item_damage"]}})},fetchPawnItems:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return p.a.api().get("/pawn_user_items",{params:{search:{keyword:e,fields:t}}})},fetchPawnDetailByPawnId:function(e){return d.a.api().get("/pawns/".concat(e),{params:{includes:["pawn_items","pawn_items.item_damage","pawn_items.item_category","payments"]}})},fetchPawnItemsByPawnId:function(e){return p.a.api().get("/pawn_items",{params:{filters:[{key:"pawn_id",value:e},{key:"complete",value:0}],includes:["item_damage","item_category"]}})},fullNameByPawnNo:function(e){return console.log("1"),p.a.query().where("pawn_no",e).first()?"".concat(p.a.query().where("pawn_no",e).first().first_name," ").concat(p.a.query().where("pawn_no",e).first().last_name):this.fullName},pawnItemByPawnNo:function(e){return console.log("2"),p.a.query().where("pawn_no",e).get()?p.a.query().where("pawn_no",e).get():[]},pawnItemCount:function(e){return console.log("3"),this.pawnItemByPawnNo(e)?this.pawnItemByPawnNo(e).length:"0"},sumPawnItemValueByPawnNo:function(e){if(!this.pawnItemByPawnNo(e))return"0";var t=Object(h.sumBy)(this.pawnItemByPawnNo(e),"item_value");return t=t.toString().split("."),console.log("4"),t.length>1?"".concat(t[0],".").concat(t[1].substring(0,2)):"".concat(t[0])},clearDataVuex:function(){f.a.deleteAll(),d.a.deleteAll(),p.a.deleteAll(),v.a.deleteAll()},searchPawnByCustomerData:function(){var e=arguments,t=this;return w(l.a.mark((function n(){var r,a,o,i,s,c,u,d,f,h,m,w,y,g,_,b,z;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},a=r.select,o=void 0===a?["pawns:id,full_name,identity_card_id,pawn_no,interest_rate,complete,customer_id,created_at,updated_at,latest_paid_at,next_paid_at"]:a,i=r.includes,s=void 0===i?[]:i,c=r.filters,u=void 0===c?[{key:"complete",value:0}]:c,d=t.perPage,f=t.currentPage,h=[],p.a.deleteAll(),v.a.deleteAll(),n.prev=5,t.search=!0,t.loading=!0,w={filters:u,select:o,page:f,limit:d},t.searchInput&&t.searchInput.length&&t.$set(w,"search",{keyword:t.searchInput,fields:["full_name","identity_card_id","pawn_no"]}),s.length&&t.$set(w,"includes",s),n.next=13,v.a.api().get("/",{params:w});case 13:m=n.sent,y=m.response.data,g=y.total,_=void 0===g?0:g,b=y.pawns,z=void 0===b?[]:b,t.totalRows=_,h=z,n.next=22;break;case 19:n.prev=19,n.t0=n.catch(5),console.log(n.t0);case 22:return n.prev=22,t.loading=!1,n.finish(22);case 25:return n.abrupt("return",h);case 26:case"end":return n.stop()}}),n,null,[[5,19,22,25]])})))()},searchPawnByCustomerDataWithItems:function(){return this.searchPawnByCustomerData({select:["pawns:id,full_name,identity_card_id,pawn_no,interest_rate,complete,customer_id,created_at,updated_at,latest_paid_at,next_paid_at,count_items,total_items_value"]})},searchAllPawnByCustomerDataWithItems:function(){return this.searchPawnByCustomerData({select:["pawns:id,full_name,identity_card_id,pawn_no,interest_rate,complete,customer_id,created_at,updated_at,latest_paid_at,next_paid_at,count_items,total_items_value"],filters:[]})}}},g={props:{reset:{type:Boolean,default:function(){return!1}}}}}}]);